<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - SuperMercado Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, where, orderBy, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyATeWSJX1mSsITEugABJFVKefWbCIuyJPM",
            authDomain: "gestaomercado-001.firebaseapp.com",
            projectId: "gestaomercado-001",
            storageBucket: "gestaomercado-001.firebasestorage.app",
            messagingSenderId: "541484410097",
            appId: "1:541484410097:web:77108a82e7273a96373550",
            measurementId: "G-TQ37LCWYKX"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Exportar para uso global
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseAddDoc = addDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseDoc = doc;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseOrderBy = orderBy;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        
        console.log("Firebase Admin inicializado com sucesso!");
        
        // Verificar autenticação
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                console.log("Admin logado:", user.email);
                
                // Carregar dados do usuário
                try {
                    const userDoc = await getDoc(doc(db, "usuarios", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        window.currentUser = {
                            ...user,
                            ...userData
                        };
                        
                        // Atualizar interface
                        if (document.getElementById('userAvatar')) {
                            document.getElementById('userAvatar').textContent = 
                                userData.nome ? userData.nome.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
                            document.getElementById('userName').textContent = userData.nome || user.email;
                            document.getElementById('userEmail').textContent = user.email;
                        }
                    }
                } catch (error) {
                    console.error("Erro ao carregar dados do usuário:", error);
                }
                
                // Inicializar sistema
                if (typeof initSistema === 'function') {
                    initSistema();
                }
            }
        });
        
        // Função de logout global
        window.adminLogout = async function() {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
        };
    </script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #9b59b6;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --sidebar-bg: #1a252f;
            --sidebar-hover: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ========== LAYOUT GERAL ========== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 30px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .logo i {
            color: var(--secondary);
            font-size: 1.8rem;
        }

        .logo-text {
            color: white;
            font-weight: 800;
        }

        .store-logo {
            max-width: 100px;
            max-height: 60px;
            margin: 15px auto;
            display: block;
            border-radius: 8px;
            object-fit: contain;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 25px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--secondary);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 1.2rem;
        }

        .nav-link span {
            font-weight: 500;
        }

        .nav-badge {
            background: var(--secondary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: auto;
        }

        .sidebar-footer {
            padding: 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: auto;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.4rem;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .user-email {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.3);
        }

        /* ========== MAIN CONTENT ========== */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            background: #f5f7fa;
        }

        .main-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e6ed;
            position: sticky;
            top: 0;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
        }

        .header-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .current-datetime {
            color: var(--gray);
            font-weight: 500;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #8e44ad);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-xs {
            padding: 5px 10px;
            font-size: 0.75rem;
        }

        /* ========== CONTENT SECTIONS ========== */
        .content-wrapper {
            padding: 30px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== CARDS ========== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: 1px solid #e0e6ed;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f3f8;
        }

        .card-title {
            font-size: 1.4rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--secondary);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ========== FORMS ========== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* ========== TABLES ========== */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e0e6ed;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .table th {
            background: #f8fafc;
            padding: 15px 20px;
            text-align: left;
            font-weight: 700;
            color: var(--primary);
            border-bottom: 2px solid #e0e6ed;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table td {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e6ed;
            vertical-align: middle;
        }

        .table tr:hover {
            background: #f8fafc;
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        /* ========== BADGES ========== */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(155, 89, 182, 0.1);
            color: var(--info);
        }

        .badge-primary {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }

        /* ========== MODALS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f3f8;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* ========== CAIXA ========== */
        .caixa-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .produtos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .produto-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .produto-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }

        .produto-nome {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 1rem;
        }

        .produto-preco {
            color: var(--success);
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .produto-estoque {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .carrinho-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 100px;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
        }

        .carrinho-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f3f8;
        }

        .carrinho-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e0e6ed;
        }

        .carrinho-item-info {
            flex: 1;
        }

        .carrinho-item-nome {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .carrinho-item-preco {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .carrinho-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .carrinho-item-quantidade {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            padding: 5px 15px;
            border-radius: 20px;
        }

        .carrinho-total {
            padding: 25px 0;
            border-top: 3px solid #e0e6ed;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .total-grande {
            font-size: 2rem;
            font-weight: 800;
            color: var(--success);
        }

        /* ========== RESPONSIVO ========== */
        @media (max-width: 1200px) {
            .caixa-container {
                grid-template-columns: 1fr;
            }
            
            .carrinho-container {
                position: relative;
                top: 0;
                max-height: none;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .header-actions {
                flex-direction: column;
                align-items: flex-end;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .produtos-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 25px;
            }
        }

        /* ========== LOADING ========== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== SEARCH ========== */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* ========== ALERTS ========== */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-success {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border-left-color: var(--success);
        }

        .alert-error {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border-left-color: var(--danger);
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border-left-color: var(--warning);
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
            border-left-color: var(--secondary);
        }

        /* ========== TABS ========== */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e6ed;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }

        .tab.active {
            color: var(--secondary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--secondary);
        }

        /* ========== COMPROVANTE ========== */
        .comprovante-preview {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 0 auto;
        }

        .comprovante-header {
            text-align: center;
            border-bottom: 2px dashed #e0e6ed;
            padding-bottom: 20px;
            margin-bottom: 25px;
        }

        .comprovante-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .comprovante-items {
            margin-bottom: 25px;
        }

        .comprovante-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f3f8;
        }

        .comprovante-total {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            border-top: 2px solid #e0e6ed;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--primary);
        }

        /* ========== CHART CONTAINER ========== */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body>
    <!-- Modais -->
    <div class="modal" id="modalProduto">
        <div class="modal-content">
            <button class="close-modal" onclick="fecharModal('modalProduto')">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-box"></i>
                    <span id="modalProdutoTitulo">Novo Produto</span>
                </h3>
            </div>
            <form id="formProduto">
                <input type="hidden" id="produtoId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Código do Produto</label>
                        <input type="text" id="produtoCodigo" class="form-control" required placeholder="Ex: PROD001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nome do Produto *</label>
                        <input type="text" id="produtoNome" class="form-control" required placeholder="Ex: Arroz 5kg">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select id="produtoCategoria" class="form-control" required>
                            <option value="">Selecione uma categoria</option>
                            <option value="alimentos">Alimentos</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="limpeza">Limpeza</option>
                            <option value="higiene">Higiene Pessoal</option>
                            <option value="hortifruti">Hortifruti</option>
                            <option value="acougue">Açougue</option>
                            <option value="padaria">Padaria</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fornecedor</label>
                        <input type="text" id="produtoFornecedor" class="form-control" placeholder="Nome do fornecedor">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Preço de Custo (R$) *</label>
                        <input type="number" id="produtoPrecoCusto" class="form-control" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preço de Venda (R$) *</label>
                        <input type="number" id="produtoPrecoVenda" class="form-control" step="0.01" min="0" required placeholder="0.00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Estoque Atual *</label>
                        <input type="number" id="produtoEstoque" class="form-control" min="0" required value="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estoque Mínimo</label>
                        <input type="number" id="produtoEstoqueMinimo" class="form-control" min="0" value="5">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <textarea id="produtoDescricao" class="form-control" rows="3" placeholder="Descrição detalhada do produto"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Imagem (URL)</label>
                    <input type="url" id="produtoImagem" class="form-control" placeholder="https://exemplo.com/imagem.jpg">
                    <small style="color: var(--gray); margin-top: 5px; display: block;">Insira a URL de uma imagem do produto</small>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="btnSalvarProduto">
                        <i class="fas fa-save"></i> Salvar Produto
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalProduto')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalCliente">
        <div class="modal-content">
            <button class="close-modal" onclick="fecharModal('modalCliente')">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user"></i>
                    <span id="modalClienteTitulo">Novo Cliente</span>
                </h3>
            </div>
            <form id="formCliente">
                <input type="hidden" id="clienteId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" id="clienteNome" class="form-control" required placeholder="Ex: João da Silva">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF</label>
                        <input type="text" id="clienteCPF" class="form-control" placeholder="000.000.000-00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Telefone *</label>
                        <input type="text" id="clienteTelefone" class="form-control" required placeholder="(11) 99999-9999">
                    </div>
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" id="clienteEmail" class="form-control" placeholder="cliente@email.com">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endereço</label>
                    <input type="text" id="clienteEndereco" class="form-control" placeholder="Rua, número, bairro">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" id="clienteNascimento" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Cliente</label>
                        <select id="clienteTipo" class="form-control">
                            <option value="normal">Normal</option>
                            <option value="vip">VIP</option>
                            <option value="fidelizado">Fidelizado</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="btnSalvarCliente">
                        <i class="fas fa-save"></i> Salvar Cliente
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalCliente')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalFuncionario">
        <div class="modal-content">
            <button class="close-modal" onclick="fecharModal('modalFuncionario')">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-tie"></i>
                    <span id="modalFuncionarioTitulo">Novo Funcionário</span>
                </h3>
            </div>
            <form id="formFuncionario">
                <input type="hidden" id="funcionarioId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" id="funcionarioNome" class="form-control" required placeholder="Ex: Maria Santos">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF *</label>
                        <input type="text" id="funcionarioCPF" class="form-control" required placeholder="000.000.000-00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Cargo *</label>
                        <select id="funcionarioCargo" class="form-control" required>
                            <option value="">Selecione um cargo</option>
                            <option value="caixa">Caixa</option>
                            <option value="gerente">Gerente</option>
                            <option value="estoque">Estoquista</option>
                            <option value="administrativo">Administrativo</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Salário (R$)</label>
                        <input type="number" id="funcionarioSalario" class="form-control" step="0.01" min="0" placeholder="0.00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Telefone *</label>
                        <input type="text" id="funcionarioTelefone" class="form-control" required placeholder="(11) 99999-9999">
                    </div>
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" id="funcionarioEmail" class="form-control" placeholder="funcionario@email.com">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endereço</label>
                    <input type="text" id="funcionarioEndereco" class="form-control" placeholder="Endereço completo">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Admissão</label>
                        <input type="date" id="funcionarioAdmissao" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="funcionarioStatus" class="form-control">
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                            <option value="ferias">Férias</option>
                            <option value="afastado">Afastado</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="btnSalvarFuncionario">
                        <i class="fas fa-save"></i> Salvar Funcionário
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalFuncionario')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalVenda">
        <div class="modal-content" style="max-width: 600px;">
            <button class="close-modal" onclick="fecharModal('modalVenda')">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-receipt"></i>
                    Detalhes da Venda
                </h3>
            </div>
            <div id="vendaDetalhes">
                <!-- Detalhes da venda serão preenchidos aqui -->
            </div>
        </div>
    </div>

    <div class="modal" id="modalConfig">
        <div class="modal-content">
            <button class="close-modal" onclick="fecharModal('modalConfig')">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-cog"></i>
                    Configurações do Sistema
                </h3>
            </div>
            <form id="formConfig">
                <div class="tabs">
                    <button type="button" class="tab active" onclick="switchConfigTab('geral')">Geral</button>
                    <button type="button" class="tab" onclick="switchConfigTab('loja')">Loja</button>
                    <button type="button" class="tab" onclick="switchConfigTab('vendas')">Vendas</button>
                    <button type="button" class="tab" onclick="switchConfigTab('estoque')">Estoque</button>
                </div>
                
                <div id="configGeral" class="config-tab active">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nome do Sistema</label>
                            <input type="text" id="configNomeSistema" class="form-control" value="SuperMercado Pro">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Moeda</label>
                            <select id="configMoeda" class="form-control">
                                <option value="BRL">Real Brasileiro (R$)</option>
                                <option value="USD">Dólar Americano ($)</option>
                                <option value="EUR">Euro (€)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fuso Horário</label>
                            <select id="configFusoHorario" class="form-control">
                                <option value="America/Sao_Paulo">Brasília (GMT-3)</option>
                                <option value="America/New_York">Nova York (GMT-5)</option>
                                <option value="Europe/London">Londres (GMT+0)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Idioma</label>
                            <select id="configIdioma" class="form-control">
                                <option value="pt-BR">Português (Brasil)</option>
                                <option value="en-US">Inglês (EUA)</option>
                                <option value="es-ES">Espanhol</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="configLoja" class="config-tab" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Nome da Loja *</label>
                        <input type="text" id="configNomeLoja" class="form-control" required placeholder="Ex: SuperMercado Central">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Logo (URL)</label>
                        <input type="url" id="configLogoUrl" class="form-control" placeholder="https://exemplo.com/logo.png">
                        <small style="color: var(--gray); margin-top: 5px; display: block;">Insira a URL da imagem do logo</small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="text" id="configTelefone" class="form-control" placeholder="(11) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label class="form-label">WhatsApp</label>
                            <input type="text" id="configWhatsApp" class="form-control" placeholder="5511999999999">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Endereço</label>
                        <textarea id="configEndereco" class="form-control" rows="3" placeholder="Endereço completo da loja"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CNPJ</label>
                            <input type="text" id="configCNPJ" class="form-control" placeholder="00.000.000/0000-00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Inscrição Estadual</label>
                            <input type="text" id="configIE" class="form-control" placeholder="Inscrição estadual">
                        </div>
                    </div>
                </div>
                
                <div id="configVendas" class="config-tab" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Imposto Padrão (%)</label>
                            <input type="number" id="configImposto" class="form-control" min="0" max="100" value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taxa de Cartão (%)</label>
                            <input type="number" id="configTaxaCartao" class="form-control" min="0" max="100" value="2.5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Formas de Pagamento Aceitas</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="configPgtoDinheiro" checked>
                                <span>Dinheiro</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="configPgtoCartao" checked>
                                <span>Cartão</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="configPgtoPix" checked>
                                <span>PIX</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="configPgtoDebito" checked>
                                <span>Débito</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="configPgtoCredito" checked>
                                <span>Crédito</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Imprimir Comprovante Automaticamente</label>
                        <select id="configImprimirAuto" class="form-control">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                </div>
                
                <div id="configEstoque" class="config-tab" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Estoque Mínimo Padrão</label>
                            <input type="number" id="configEstoqueMinimo" class="form-control" min="1" value="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Alerta de Estoque Baixo</label>
                            <select id="configAlertaEstoque" class="form-control">
                                <option value="sim">Ativar Alertas</option>
                                <option value="nao">Desativar Alertas</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Controlar Validade de Produtos</label>
                        <select id="configControlarValidade" class="form-control">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dias para Alerta de Validade</label>
                        <input type="number" id="configDiasValidade" class="form-control" min="1" value="30">
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Configurações
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalConfig')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalComprovante">
        <div class="modal-content" style="max-width: 500px;">
            <button class="close-modal" onclick="fecharModal('modalComprovante')">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-receipt"></i>
                    Comprovante de Venda
                </h3>
            </div>
            <div class="comprovante-preview" id="comprovantePreview">
                <div class="comprovante-header">
                    <h2 class="comprovante-title" id="comprovanteNomeLoja">SUPERMERCADO PRO</h2>
                    <p id="comprovanteEndereco">Endereço não configurado</p>
                    <p id="comprovanteTelefone">Telefone não configurado</p>
                    <p id="comprovanteCNPJ">CNPJ: Não informado</p>
                    <p id="comprovanteData">Data: 01/01/2024 10:00:00</p>
                    <p id="comprovanteVenda">Venda: #000001</p>
                </div>
                <div class="comprovante-items" id="comprovanteItems">
                    <!-- Itens serão inseridos aqui -->
                </div>
                <div class="comprovante-total">
                    <span>TOTAL:</span>
                    <span id="comprovanteTotal">R$ 0,00</span>
                </div>
                <div style="text-align: center; margin-top: 25px; color: var(--gray); padding-top: 20px; border-top: 1px dashed #e0e6ed;">
                    <p>Obrigado pela preferência!</p>
                    <p>Volte sempre!</p>
                </div>
            </div>
            <div style="display: flex; gap: 15px; margin-top: 25px; justify-content: center;">
                <button class="btn btn-primary" onclick="imprimirComprovante()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" onclick="salvarComprovante()">
                    <i class="fas fa-download"></i> Salvar PDF
                </button>
                <button class="btn btn-outline" onclick="fecharModal('modalComprovante')">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Layout Principal -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="logo-text">SuperMercado Pro</span>
                </div>
                <img src="" alt="Logo da Loja" class="store-logo" id="storeLogo" style="display: none;">
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="caixa">
                        <i class="fas fa-cash-register"></i>
                        <span>Caixa</span>
                        <span class="nav-badge" id="badgeCaixa">NOVO</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="produtos">
                        <i class="fas fa-boxes"></i>
                        <span>Produtos</span>
                        <span class="nav-badge" id="badgeProdutos">0</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="clientes">
                        <i class="fas fa-users"></i>
                        <span>Clientes</span>
                        <span class="nav-badge" id="badgeClientes">0</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="funcionarios">
                        <i class="fas fa-user-tie"></i>
                        <span>Funcionários</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="vendas">
                        <i class="fas fa-chart-bar"></i>
                        <span>Vendas</span>
                        <span class="nav-badge" id="badgeVendas">0</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="relatorios">
                        <i class="fas fa-file-alt"></i>
                        <span>Relatórios</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-section="configuracoes">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Administrador</div>
                        <div class="user-email" id="userEmail">carregando...</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="adminLogout()">
                    <i class="fas fa-sign-out-alt"></i> Sair do Sistema
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-title" id="headerTitle">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </div>
                </div>
                <div class="header-actions">
                    <div class="current-datetime" id="currentDateTime">
                        Carregando...
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-primary btn-sm" onclick="abrirModal('modalComprovante')" id="btnComprovante" style="display: none;">
                            <i class="fas fa-receipt"></i> Comprovante
                        </button>
                        <button class="btn btn-success btn-sm" onclick="mostrarSecao('caixa')">
                            <i class="fas fa-plus"></i> Nova Venda
                        </button>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <!-- Alertas -->
                <div id="alertContainer"></div>

                <!-- Dashboard -->
                <section id="section-dashboard" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card" onclick="mostrarSecao('vendas')">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-value" id="statVendasHoje">0</div>
                            <div class="stat-label">Vendas Hoje</div>
                        </div>
                        <div class="stat-card" onclick="mostrarSecao('produtos')">
                            <div class="stat-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-value" id="statProdutos">0</div>
                            <div class="stat-label">Produtos</div>
                        </div>
                        <div class="stat-card" onclick="mostrarSecao('clientes')">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="statClientes">0</div>
                            <div class="stat-label">Clientes</div>
                        </div>
                        <div class="stat-card" onclick="mostrarSecao('caixa')">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-value" id="statFaturamento">R$ 0</div>
                            <div class="stat-label">Faturamento</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                Vendas dos Últimos 7 Dias
                            </h3>
                            <select class="form-control" style="width: auto;" onchange="atualizarGraficoVendas(this.value)">
                                <option value="7">7 dias</option>
                                <option value="30">30 dias</option>
                                <option value="90">90 dias</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="graficoVendas"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                Produtos com Estoque Baixo
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="carregarProdutos()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Produto</th>
                                        <th>Estoque Atual</th>
                                        <th>Estoque Mínimo</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaEstoqueBaixo">
                                    <!-- Dados serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-history"></i>
                                Últimas Vendas
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="mostrarSecao('vendas')">
                                <i class="fas fa-list"></i> Ver Todas
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Data/Hora</th>
                                        <th>Cliente</th>
                                        <th>Produtos</th>
                                        <th>Valor</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaUltimasVendas">
                                    <!-- Dados serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Caixa -->
                <section id="section-caixa" class="content-section">
                    <div class="caixa-container">
                        <div>
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fas fa-search"></i>
                                        Produtos para Venda
                                    </h3>
                                    <div class="search-container">
                                        <input type="text" id="buscaProdutoCaixa" class="search-input" 
                                               placeholder="Digite o nome ou código do produto..." 
                                               onkeyup="filtrarProdutosCaixa(this.value)">
                                        <button class="btn btn-primary" onclick="abrirModal('modalProduto')">
                                            <i class="fas fa-plus"></i> Novo
                                        </button>
                                    </div>
                                </div>
                                <div class="produtos-grid" id="produtosCaixaGrid">
                                    <!-- Produtos serão carregados aqui -->
                                </div>
                            </div>
                        </div>

                        <div class="carrinho-container">
                            <div class="carrinho-header">
                                <h3 class="card-title">
                                    <i class="fas fa-shopping-cart"></i>
                                    Carrinho de Compras
                                </h3>
                                <button class="btn btn-danger btn-sm" onclick="limparCarrinho()">
                                    <i class="fas fa-trash"></i> Limpar
                                </button>
                            </div>
                            
                            <div id="carrinhoItens">
                                <div style="text-align: center; padding: 50px 20px; color: var(--gray);">
                                    <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                    <p>Nenhum produto no carrinho</p>
                                    <p style="font-size: 0.9rem; margin-top: 10px;">Clique nos produtos ao lado para adicionar</p>
                                </div>
                            </div>
                            
                            <div class="carrinho-total">
                                <div class="total-row">
                                    <span>Subtotal:</span>
                                    <span id="carrinhoSubtotal">R$ 0,00</span>
                                </div>
                                <div class="total-row">
                                    <span>Desconto:</span>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="number" id="carrinhoDesconto" class="form-control" 
                                               style="width: 100px; text-align: right;" 
                                               value="0" min="0" step="0.01" onchange="calcularTotalCarrinho()">
                                        <span>R$</span>
                                    </div>
                                </div>
                                <div class="total-row" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e6ed;">
                                    <strong>TOTAL:</strong>
                                    <strong class="total-grande" id="carrinhoTotal">R$ 0,00</strong>
                                </div>
                            </div>
                            
                            <div style="margin-top: 30px;">
                                <div class="form-group">
                                    <label class="form-label">Cliente</label>
                                    <div style="display: flex; gap: 10px;">
                                        <select id="clienteVenda" class="form-control" onchange="selecionarClienteVenda(this.value)">
                                            <option value="">Cliente não identificado</option>
                                        </select>
                                        <button class="btn btn-success btn-sm" onclick="abrirModal('modalCliente')">
                                            <i class="fas fa-user-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Forma de Pagamento</label>
                                    <select id="formaPagamento" class="form-control" onchange="selecionarFormaPagamento(this.value)">
                                        <option value="dinheiro">Dinheiro</option>
                                        <option value="cartao_debito">Cartão Débito</option>
                                        <option value="cartao_credito">Cartão Crédito</option>
                                        <option value="pix">PIX</option>
                                        <option value="transferencia">Transferência</option>
                                    </select>
                                </div>
                                
                                <div id="campoDinheiro" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Valor Recebido (R$)</label>
                                            <input type="number" id="valorRecebido" class="form-control" 
                                                   step="0.01" min="0" onchange="calcularTroco()">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Troco (R$)</label>
                                            <input type="number" id="valorTroco" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="campoCartao" style="display: none;">
                                    <div class="form-group">
                                        <label class="form-label">Nº do Cartão (últimos 4)</label>
                                        <input type="text" id="numeroCartao" class="form-control" maxlength="4">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Parcelas</label>
                                        <select id="parcelasCartao" class="form-control">
                                            <option value="1">1x</option>
                                            <option value="2">2x</option>
                                            <option value="3">3x</option>
                                            <option value="4">4x</option>
                                            <option value="5">5x</option>
                                            <option value="6">6x</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <button class="btn btn-success" style="width: 100%; margin-top: 20px; padding: 16px;" 
                                        onclick="finalizarVenda()" id="btnFinalizarVenda">
                                    <i class="fas fa-check-circle"></i> Finalizar Venda
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Produtos -->
                <section id="section-produtos" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-boxes"></i>
                                Gerenciar Produtos
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscaProdutos" class="form-control" 
                                       placeholder="Buscar produto..." 
                                       onkeyup="filtrarProdutosAdmin(this.value)">
                                <button class="btn btn-success" onclick="abrirModalProduto()">
                                    <i class="fas fa-plus"></i> Novo Produto
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Produto</th>
                                        <th>Categoria</th>
                                        <th>Preço Custo</th>
                                        <th>Preço Venda</th>
                                        <th>Estoque</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaProdutos">
                                    <!-- Produtos serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                Estatísticas de Produtos
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="gerarRelatorioProdutos()">
                                <i class="fas fa-download"></i> Relatório
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div class="stat-card">
                                <div class="stat-value" id="totalProdutosCadastrados">0</div>
                                <div class="stat-label">Total Produtos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="valorTotalEstoque">R$ 0</div>
                                <div class="stat-label">Valor em Estoque</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="produtosSemEstoqueCount">0</div>
                                <div class="stat-label">Sem Estoque</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="categoriaMaisProdutos">-</div>
                                <div class="stat-label">Categoria Maior</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Clientes -->
                <section id="section-clientes" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-users"></i>
                                Gerenciar Clientes
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscaClientes" class="form-control" 
                                       placeholder="Buscar cliente..." 
                                       onkeyup="filtrarClientes(this.value)">
                                <button class="btn btn-success" onclick="abrirModalCliente()">
                                    <i class="fas fa-user-plus"></i> Novo Cliente
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>CPF</th>
                                        <th>Telefone</th>
                                        <th>Email</th>
                                        <th>Tipo</th>
                                        <th>Total Compras</th>
                                        <th>Última Compra</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaClientes">
                                    <!-- Clientes serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-line"></i>
                                Análise de Clientes
                            </h3>
                            <select class="form-control" style="width: auto;" onchange="atualizarGraficoClientes(this.value)">
                                <option value="mensal">Mensal</option>
                                <option value="trimestral">Trimestral</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="graficoClientes"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Funcionários -->
                <section id="section-funcionarios" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-user-tie"></i>
                                Gerenciar Funcionários
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscaFuncionarios" class="form-control" 
                                       placeholder="Buscar funcionário..." 
                                       onkeyup="filtrarFuncionarios(this.value)">
                                <button class="btn btn-success" onclick="abrirModalFuncionario()">
                                    <i class="fas fa-user-plus"></i> Novo Funcionário
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Cargo</th>
                                        <th>CPF</th>
                                        <th>Telefone</th>
                                        <th>Salário</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaFuncionarios">
                                    <!-- Funcionários serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Vendas -->
                <section id="section-vendas" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                Histórico de Vendas
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="date" id="dataInicioVendas" class="form-control">
                                <input type="date" id="dataFimVendas" class="form-control" value="">
                                <button class="btn btn-primary" onclick="filtrarVendasPorData()">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                                <button class="btn btn-success" onclick="exportarVendas()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data/Hora</th>
                                        <th>Cliente</th>
                                        <th>Produtos</th>
                                        <th>Valor</th>
                                        <th>Pagamento</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaVendas">
                                    <!-- Vendas serão carregadas aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-exchange-alt"></i>
                                Cancelamento de Vendas
                            </h3>
                            <button class="btn btn-warning btn-sm" onclick="carregarCancelamentos()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID Venda</th>
                                        <th>Cliente</th>
                                        <th>Valor</th>
                                        <th>Solicitado Por</th>
                                        <th>Motivo</th>
                                        <th>Data Solicitação</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaCancelamentos">
                                    <!-- Cancelamentos serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Relatórios -->
                <section id="section-relatorios" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-file-alt"></i>
                                Gerar Relatórios
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="gerarRelatorioCompleto()">
                                <i class="fas fa-file-pdf"></i> PDF Completo
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;">
                            <div class="card" style="text-align: center;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-chart-line"></i> Vendas
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Relatório detalhado de vendas por período</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('vendas')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                            <div class="card" style="text-align: center;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-boxes"></i> Estoque
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Análise de estoque e produtos</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('estoque')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                            <div class="card" style="text-align: center;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-users"></i> Clientes
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Análise de clientes e fidelidade</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('clientes')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                            <div class="card" style="text-align: center;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-money-bill-wave"></i> Financeiro
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Análise financeira completa</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('financeiro')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-download"></i>
                                Exportar Dados
                            </h3>
                            <button class="btn btn-success" onclick="exportarTodosDados()">
                                <i class="fas fa-file-excel"></i> Exportar Tudo
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <button class="btn btn-outline" onclick="exportarDados('produtos')">
                                <i class="fas fa-box"></i> Produtos
                            </button>
                            <button class="btn btn-outline" onclick="exportarDados('clientes')">
                                <i class="fas fa-users"></i> Clientes
                            </button>
                            <button class="btn btn-outline" onclick="exportarDados('vendas')">
                                <i class="fas fa-shopping-cart"></i> Vendas
                            </button>
                            <button class="btn btn-outline" onclick="exportarDados('funcionarios')">
                                <i class="fas fa-user-tie"></i> Funcionários
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Configurações -->
                <section id="section-configuracoes" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-cog"></i>
                                Configurações do Sistema
                            </h3>
                            <button class="btn btn-primary" onclick="abrirModal('modalConfig')">
                                <i class="fas fa-edit"></i> Editar Configurações
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 20px;">Informações da Loja</h4>
                                <div id="infoLoja">
                                    <!-- Informações serão carregadas aqui -->
                                </div>
                            </div>
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 20px;">Estatísticas do Sistema</h4>
                                <div id="infoSistema">
                                    <!-- Informações serão carregadas aqui -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-shield-alt"></i>
                                Segurança e Backup
                            </h3>
                            <button class="btn btn-warning" onclick="criarBackup()">
                                <i class="fas fa-database"></i> Criar Backup
                            </button>
                        </div>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <button class="btn btn-outline" onclick="alterarSenha()">
                                <i class="fas fa-key"></i> Alterar Senha
                            </button>
                            <button class="btn btn-outline" onclick="gerarLogs()">
                                <i class="fas fa-file-alt"></i> Ver Logs
                            </button>
                            <button class="btn btn-outline" onclick="restaurarBackup()">
                                <i class="fas fa-undo"></i> Restaurar Backup
                            </button>
                            <button class="btn btn-danger" onclick="limparDados()">
                                <i class="fas fa-trash"></i> Limpar Dados
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Scripts Externos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // ========== VARIÁVEIS GLOBAIS ==========
        let produtos = [];
        let clientes = [];
        let funcionarios = [];
        let vendas = [];
        let carrinho = [];
        let configuracoes = {};
        let graficoVendas = null;
        let graficoClientes = null;
        
        // ========== INICIALIZAÇÃO ==========
        function initSistema() {
            console.log("Inicializando sistema administrativo...");
            
            // Configurar data/hora
            atualizarDataHora();
            setInterval(atualizarDataHora, 1000);
            
            // Configurar navegação
            configurarNavegacao();
            
            // Configurar menu mobile
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Configurar formulários
            configurarFormularios();
            
            // Carregar configurações
            carregarConfiguracoes();
            
            // Carregar dados iniciais
            carregarDadosIniciais();
            
            // Verificar se há seção específica na URL
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');
            if (section) {
                mostrarSecao(section);
            }
        }
        
        // ========== NAVEGAÇÃO ==========
        function configurarNavegacao() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    mostrarSecao(section);
                    
                    // Atualizar links ativos
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Fechar menu mobile se aberto
                    if (window.innerWidth <= 992) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
        }
        
        function mostrarSecao(sectionName) {
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar seção selecionada
            const targetSection = document.getElementById(`section-${sectionName}`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Atualizar título
            const titles = {
                'dashboard': 'Dashboard',
                'caixa': 'Caixa',
                'produtos': 'Produtos',
                'clientes': 'Clientes',
                'funcionarios': 'Funcionários',
                'vendas': 'Vendas',
                'relatorios': 'Relatórios',
                'configuracoes': 'Configurações'
            };
            
            const icons = {
                'dashboard': 'tachometer-alt',
                'caixa': 'cash-register',
                'produtos': 'boxes',
                'clientes': 'users',
                'funcionarios': 'user-tie',
                'vendas': 'chart-bar',
                'relatorios': 'file-alt',
                'configuracoes': 'cog'
            };
            
            document.getElementById('headerTitle').innerHTML = 
                `<i class="fas fa-${icons[sectionName]}"></i> ${titles[sectionName]}`;
            
            // Mostrar/ocultar botão de comprovante
            document.getElementById('btnComprovante').style.display = 
                sectionName === 'caixa' ? 'inline-flex' : 'none';
            
            // Carregar dados da seção
            switch(sectionName) {
                case 'dashboard':
                    carregarDashboard();
                    break;
                case 'caixa':
                    carregarCaixa();
                    break;
                case 'produtos':
                    carregarProdutos();
                    break;
                case 'clientes':
                    carregarClientes();
                    break;
                case 'funcionarios':
                    carregarFuncionarios();
                    break;
                case 'vendas':
                    carregarVendas();
                    break;
                case 'configuracoes':
                    carregarInfoConfiguracoes();
                    break;
            }
        }
        
        // ========== DATA/HORA ==========
        function atualizarDataHora() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = 
                now.toLocaleDateString('pt-BR', options);
        }
        
        // ========== MODAIS ==========
        function abrirModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function fecharModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function abrirModalProduto() {
            document.getElementById('modalProdutoTitulo').textContent = 'Novo Produto';
            document.getElementById('produtoId').value = '';
            document.getElementById('formProduto').reset();
            abrirModal('modalProduto');
        }
        
        function abrirModalCliente() {
            document.getElementById('modalClienteTitulo').textContent = 'Novo Cliente';
            document.getElementById('clienteId').value = '';
            document.getElementById('formCliente').reset();
            abrirModal('modalCliente');
        }
        
        function abrirModalFuncionario() {
            document.getElementById('modalFuncionarioTitulo').textContent = 'Novo Funcionário';
            document.getElementById('funcionarioId').value = '';
            document.getElementById('formFuncionario').reset();
            abrirModal('modalFuncionario');
        }
        
        function switchConfigTab(tab) {
            const tabs = document.querySelectorAll('.config-tab');
            const tabButtons = document.querySelectorAll('#modalConfig .tab');
            
            tabs.forEach(t => t.style.display = 'none');
            tabButtons.forEach(b => b.classList.remove('active'));
            
            document.getElementById(`config${tab.charAt(0).toUpperCase() + tab.slice(1)}`).style.display = 'block';
            document.querySelector(`#modalConfig .tab[onclick="switchConfigTab('${tab}')"]`).classList.add('active');
        }
        
        // ========== ALERTAS ==========
        function mostrarAlerta(mensagem, tipo = 'info', tempo = 5000) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${tipo}`;
            alert.innerHTML = `
                <i class="fas fa-${tipo === 'success' ? 'check-circle' : tipo === 'error' ? 'exclamation-circle' : tipo === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                ${mensagem}
            `;
            
            alertContainer.insertBefore(alert, alertContainer.firstChild);
            
            // Remover após o tempo especificado
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, tempo);
        }
        
        // ========== CONFIGURAÇÕES ==========
        async function carregarConfiguracoes() {
            try {
                const db = window.firebaseDb;
                const docRef = window.firebaseDoc(db, "configuracoes", "geral");
                const docSnap = await window.firebaseGetDoc(docRef);
                
                if (docSnap.exists()) {
                    configuracoes = docSnap.data();
                    
                    // Atualizar logo se existir
                    if (configuracoes.logoUrl) {
                        const logoImg = document.getElementById('storeLogo');
                        logoImg.src = configuracoes.logoUrl;
                        logoImg.style.display = 'block';
                        logoImg.onerror = function() {
                            this.style.display = 'none';
                        };
                    }
                    
                    // Preencher formulário de configurações
                    if (configuracoes.nomeLoja) {
                        document.getElementById('configNomeLoja').value = configuracoes.nomeLoja;
                        document.getElementById('configLogoUrl').value = configuracoes.logoUrl || '';
                        document.getElementById('configTelefone').value = configuracoes.telefone || '';
                        document.getElementById('configWhatsApp').value = configuracoes.whatsApp || '';
                        document.getElementById('configEndereco').value = configuracoes.endereco || '';
                        document.getElementById('configCNPJ').value = configuracoes.cnpj || '';
                        document.getElementById('configIE').value = configuracoes.ie || '';
                        document.getElementById('configImposto').value = configuracoes.imposto || 0;
                    }
                } else {
                    // Configurações padrão
                    configuracoes = {
                        nomeLoja: "SuperMercado Pro",
                        logoUrl: "",
                        telefone: "",
                        whatsApp: "",
                        endereco: "",
                        cnpj: "",
                        ie: "",
                        imposto: 0,
                        taxaCartao: 2.5
                    };
                    
                    // Salvar configurações padrão
                    await window.firebaseSetDoc(docRef, configuracoes);
                }
                
                console.log("Configurações carregadas:", configuracoes);
                
            } catch (error) {
                console.error("Erro ao carregar configurações:", error);
                mostrarAlerta("Erro ao carregar configurações", "error");
            }
        }
        
        async function salvarConfiguracoes() {
            try {
                const db = window.firebaseDb;
                const docRef = window.firebaseDoc(db, "configuracoes", "geral");
                
                configuracoes.nomeLoja = document.getElementById('configNomeLoja').value;
                configuracoes.logoUrl = document.getElementById('configLogoUrl').value;
                configuracoes.telefone = document.getElementById('configTelefone').value;
                configuracoes.whatsApp = document.getElementById('configWhatsApp').value;
                configuracoes.endereco = document.getElementById('configEndereco').value;
                configuracoes.cnpj = document.getElementById('configCNPJ').value;
                configuracoes.ie = document.getElementById('configIE').value;
                configuracoes.imposto = parseFloat(document.getElementById('configImposto').value) || 0;
                configuracoes.taxaCartao = parseFloat(document.getElementById('configTaxaCartao').value) || 2.5;
                
                await window.firebaseSetDoc(docRef, configuracoes);
                
                // Atualizar logo
                if (configuracoes.logoUrl) {
                    const logoImg = document.getElementById('storeLogo');
                    logoImg.src = configuracoes.logoUrl;
                    logoImg.style.display = 'block';
                    logoImg.onerror = function() {
                        this.style.display = 'none';
                    };
                } else {
                    document.getElementById('storeLogo').style.display = 'none';
                }
                
                mostrarAlerta("Configurações salvas com sucesso!", "success");
                fecharModal('modalConfig');
                
            } catch (error) {
                console.error("Erro ao salvar configurações:", error);
                mostrarAlerta("Erro ao salvar configurações", "error");
            }
        }
        
        function carregarInfoConfiguracoes() {
            const infoLoja = document.getElementById('infoLoja');
            const infoSistema = document.getElementById('infoSistema');
            
            infoLoja.innerHTML = `
                <p><strong>Nome da Loja:</strong> ${configuracoes.nomeLoja || 'Não configurado'}</p>
                <p><strong>CNPJ:</strong> ${configuracoes.cnpj || 'Não informado'}</p>
                <p><strong>Telefone:</strong> ${configuracoes.telefone || 'Não informado'}</p>
                <p><strong>Endereço:</strong> ${configuracoes.endereco || 'Não informado'}</p>
                <p><strong>Imposto Padrão:</strong> ${configuracoes.imposto || 0}%</p>
            `;
            
            infoSistema.innerHTML = `
                <p><strong>Total de Produtos:</strong> <span id="totalProdutosConfig">0</span></p>
                <p><strong>Total de Clientes:</strong> <span id="totalClientesConfig">0</span></p>
                <p><strong>Total de Vendas:</strong> <span id="totalVendasConfig">0</span></p>
                <p><strong>Valor em Estoque:</strong> <span id="valorEstoqueConfig">R$ 0,00</span></p>
                <p><strong>Último Backup:</strong> Não realizado</p>
            `;
        }
        
        // ========== FORMULÁRIOS ==========
        function configurarFormularios() {
            // Formulário de produto
            document.getElementById('formProduto').addEventListener('submit', salvarProduto);
            
            // Formulário de cliente
            document.getElementById('formCliente').addEventListener('submit', salvarCliente);
            
            // Formulário de funcionário
            document.getElementById('formFuncionario').addEventListener('submit', salvarFuncionario);
            
            // Formulário de configurações
            document.getElementById('formConfig').addEventListener('submit', function(e) {
                e.preventDefault();
                salvarConfiguracoes();
            });
            
            // Cálculo automático de preços
            document.getElementById('produtoPrecoCusto').addEventListener('input', calcularMargem);
            document.getElementById('produtoPrecoVenda').addEventListener('input', calcularMargem);
        }
        
        function calcularMargem() {
            const custo = parseFloat(document.getElementById('produtoPrecoCusto').value) || 0;
            const venda = parseFloat(document.getElementById('produtoPrecoVenda').value) || 0;
            
            if (custo > 0 && venda > 0) {
                const margem = ((venda - custo) / venda) * 100;
                // Pode exibir a margem em algum lugar se quiser
            }
        }
        
        // ========== DASHBOARD ==========
        async function carregarDashboard() {
            await carregarEstatisticas();
            await carregarProdutosEstoqueBaixo();
            await carregarUltimasVendas();
            criarGraficoVendas();
        }
        
        async function carregarEstatisticas() {
            try {
                // Em produção, essas consultas viriam do Firebase
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                // Simulando dados
                const vendasHoje = vendas.filter(v => new Date(v.data) >= hoje).length;
                const totalProdutos = produtos.length;
                const totalClientes = clientes.length;
                const faturamento = vendas.reduce((total, v) => total + v.valorTotal, 0);
                
                document.getElementById('statVendasHoje').textContent = vendasHoje;
                document.getElementById('statProdutos').textContent = totalProdutos;
                document.getElementById('statClientes').textContent = totalClientes;
                document.getElementById('statFaturamento').textContent = `R$ ${faturamento.toFixed(2)}`;
                
                // Atualizar badges
                document.getElementById('badgeProdutos').textContent = totalProdutos;
                document.getElementById('badgeClientes').textContent = totalClientes;
                document.getElementById('badgeVendas').textContent = vendas.length;
                
            } catch (error) {
                console.error("Erro ao carregar estatísticas:", error);
            }
        }
        
        async function carregarProdutosEstoqueBaixo() {
            try {
                const produtosBaixo = produtos.filter(p => p.estoque <= (p.estoqueMinimo || 5));
                const tbody = document.getElementById('tabelaEstoqueBaixo');
                tbody.innerHTML = '';
                
                if (produtosBaixo.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px; color: var(--success);">
                                <i class="fas fa-check-circle"></i> Todos os produtos com estoque adequado
                            </td>
                        </tr>
                    `;
                } else {
                    produtosBaixo.forEach(produto => {
                        const status = produto.estoque <= 0 ? 
                            `<span class="badge badge-danger">ESGOTADO</span>` :
                            `<span class="badge badge-warning">BAIXO</span>`;
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>
                                <div><strong>${produto.nome}</strong></div>
                                <small>Código: ${produto.codigo}</small>
                            </td>
                            <td>${produto.estoque}</td>
                            <td>${produto.estoqueMinimo || 5}</td>
                            <td>${status}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-primary btn-xs" onclick="editarProduto('${produto.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-success btn-xs" onclick="reporEstoque('${produto.id}')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
            } catch (error) {
                console.error("Erro ao carregar produtos com estoque baixo:", error);
            }
        }
        
        async function carregarUltimasVendas() {
            try {
                const ultimasVendas = vendas.slice(-10).reverse();
                const tbody = document.getElementById('tabelaUltimasVendas');
                tbody.innerHTML = '';
                
                if (ultimasVendas.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray);">
                                <i class="fas fa-receipt"></i> Nenhuma venda realizada
                            </td>
                        </tr>
                    `;
                } else {
                    ultimasVendas.forEach(venda => {
                        const produtosLista = venda.itens.slice(0, 2).map(item => 
                            `${item.quantidade}x ${item.nome}`
                        ).join(', ');
                        
                        const maisItens = venda.itens.length > 2 ? ` e +${venda.itens.length - 2}` : '';
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${new Date(venda.data).toLocaleString('pt-BR')}</td>
                            <td>${venda.clienteNome || 'Cliente não identificado'}</td>
                            <td>${produtosLista}${maisItens}</td>
                            <td>R$ ${venda.valorTotal.toFixed(2)}</td>
                            <td><span class="badge badge-success">CONCLUÍDA</span></td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
            } catch (error) {
                console.error("Erro ao carregar últimas vendas:", error);
            }
        }
        
        function criarGraficoVendas() {
            const ctx = document.getElementById('graficoVendas').getContext('2d');
            
            if (graficoVendas) {
                graficoVendas.destroy();
            }
            
            // Dados de exemplo
            const labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            const data = [1200, 1900, 1500, 2300, 2800, 3200, 2900];
            
            graficoVendas = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoVendas(dias) {
            // Em produção, atualizaria o gráfico com dados reais
            mostrarAlerta(`Gráfico atualizado para ${dias} dias`, 'info');
        }
        
        // ========== CAIXA ==========
        async function carregarCaixa() {
            await carregarProdutosParaCaixa();
            carregarClientesParaVenda();
            limparCarrinho();
        }
        
        async function carregarProdutosParaCaixa() {
            try {
                // Em produção, viria do Firebase
                // Para exemplo, usaremos produtos simulados
                if (produtos.length === 0) {
                    produtos = [
                        {
                            id: 'prod1',
                            codigo: 'ARZ001',
                            nome: 'Arroz 5kg',
                            precoVenda: 24.90,
                            estoque: 50,
                            categoria: 'alimentos',
                            imagem: ''
                        },
                        {
                            id: 'prod2',
                            codigo: 'FEA001',
                            nome: 'Feijão 1kg',
                            precoVenda: 8.50,
                            estoque: 30,
                            categoria: 'alimentos',
                            imagem: ''
                        },
                        {
                            id: 'prod3',
                            codigo: 'OLE001',
                            nome: 'Óleo de Soja 900ml',
                            precoVenda: 7.90,
                            estoque: 25,
                            categoria: 'alimentos',
                            imagem: ''
                        },
                        {
                            id: 'prod4',
                            codigo: 'CAF001',
                            nome: 'Café 500g',
                            precoVenda: 12.90,
                            estoque: 40,
                            categoria: 'alimentos',
                            imagem: ''
                        },
                        {
                            id: 'prod5',
                            codigo: 'LET001',
                            nome: 'Leite 1L',
                            precoVenda: 5.90,
                            estoque: 60,
                            categoria: 'laticinios',
                            imagem: ''
                        },
                        {
                            id: 'prod6',
                            codigo: 'SAB001',
                            nome: 'Sabão em Pó 1kg',
                            precoVenda: 14.90,
                            estoque: 20,
                            categoria: 'limpeza',
                            imagem: ''
                        }
                    ];
                }
                
                const container = document.getElementById('produtosCaixaGrid');
                container.innerHTML = '';
                
                produtos.forEach(produto => {
                    if (produto.estoque > 0) {
                        const div = document.createElement('div');
                        div.className = 'produto-item';
                        div.onclick = () => adicionarAoCarrinho(produto);
                        
                        div.innerHTML = `
                            <div class="produto-nome">${produto.nome}</div>
                            <div class="produto-preco">R$ ${produto.precoVenda.toFixed(2)}</div>
                            <div class="produto-estoque">Estoque: ${produto.estoque}</div>
                            ${produto.codigo ? `<small>Código: ${produto.codigo}</small>` : ''}
                        `;
                        
                        container.appendChild(div);
                    }
                });
                
            } catch (error) {
                console.error("Erro ao carregar produtos para caixa:", error);
                mostrarAlerta("Erro ao carregar produtos", "error");
            }
        }
        
        function filtrarProdutosCaixa(termo) {
            const produtosItems = document.querySelectorAll('.produto-item');
            const termoLower = termo.toLowerCase();
            
            produtosItems.forEach(item => {
                const nome = item.querySelector('.produto-nome').textContent.toLowerCase();
                const codigo = item.querySelector('small')?.textContent.toLowerCase() || '';
                
                if (nome.includes(termoLower) || codigo.includes(termoLower)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function adicionarAoCarrinho(produto) {
            // Verificar se já está no carrinho
            const itemExistente = carrinho.find(item => item.id === produto.id);
            
            if (itemExistente) {
                // Verificar estoque
                if (itemExistente.quantidade >= produto.estoque) {
                    mostrarAlerta('Estoque insuficiente!', 'error');
                    return;
                }
                itemExistente.quantidade++;
            } else {
                // Verificar estoque
                if (produto.estoque < 1) {
                    mostrarAlerta('Produto sem estoque!', 'error');
                    return;
                }
                
                carrinho.push({
                    id: produto.id,
                    codigo: produto.codigo,
                    nome: produto.nome,
                    preco: produto.precoVenda,
                    quantidade: 1,
                    estoque: produto.estoque
                });
            }
            
            atualizarCarrinho();
        }
        
        function atualizarCarrinho() {
            const container = document.getElementById('carrinhoItens');
            
            if (carrinho.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: var(--gray);">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Nenhum produto no carrinho</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Clique nos produtos ao lado para adicionar</p>
                    </div>
                `;
            } else {
                let html = '';
                carrinho.forEach((item, index) => {
                    const subtotal = item.preco * item.quantidade;
                    html += `
                        <div class="carrinho-item">
                            <div class="carrinho-item-info">
                                <div class="carrinho-item-nome">${item.nome}</div>
                                <div class="carrinho-item-preco">R$ ${item.preco.toFixed(2)}</div>
                            </div>
                            <div class="carrinho-item-actions">
                                <div class="carrinho-item-quantidade">
                                    <button class="btn btn-xs" onclick="alterarQuantidadeCarrinho(${index}, -1)" ${item.quantidade <= 1 ? 'disabled' : ''}>
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span>${item.quantidade}</span>
                                    <button class="btn btn-xs" onclick="alterarQuantidadeCarrinho(${index}, 1)" ${item.quantidade >= item.estoque ? 'disabled' : ''}>
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div style="text-align: right; min-width: 80px;">
                                    <div style="font-weight: 700; color: var(--success);">R$ ${subtotal.toFixed(2)}</div>
                                </div>
                                <button class="btn btn-danger btn-xs" onclick="removerDoCarrinho(${index})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
            
            calcularTotalCarrinho();
        }
        
        function alterarQuantidadeCarrinho(index, delta) {
            const item = carrinho[index];
            const novaQuantidade = item.quantidade + delta;
            
            if (novaQuantidade < 1) {
                removerDoCarrinho(index);
                return;
            }
            
            if (novaQuantidade > item.estoque) {
                mostrarAlerta('Quantidade excede o estoque disponível!', 'error');
                return;
            }
            
            item.quantidade = novaQuantidade;
            atualizarCarrinho();
        }
        
        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarCarrinho();
            mostrarAlerta('Produto removido do carrinho', 'warning');
        }
        
        function calcularTotalCarrinho() {
            const subtotal = carrinho.reduce((total, item) => 
                total + (item.preco * item.quantidade), 0);
            
            const desconto = parseFloat(document.getElementById('carrinhoDesconto').value) || 0;
            const total = Math.max(0, subtotal - desconto);
            
            document.getElementById('carrinhoSubtotal').textContent = 
                `R$ ${subtotal.toFixed(2)}`;
            document.getElementById('carrinhoTotal').textContent = 
                `R$ ${total.toFixed(2)}`;
        }
        
        function limparCarrinho() {
            carrinho = [];
            atualizarCarrinho();
            document.getElementById('carrinhoDesconto').value = '0';
            document.getElementById('clienteVenda').value = '';
            document.getElementById('formaPagamento').value = 'dinheiro';
            document.getElementById('campoDinheiro').style.display = 'none';
            document.getElementById('campoCartao').style.display = 'none';
        }
        
        function carregarClientesParaVenda() {
            const select = document.getElementById('clienteVenda');
            select.innerHTML = '<option value="">Cliente não identificado</option>';
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                select.appendChild(option);
            });
        }
        
        function selecionarClienteVenda(clienteId) {
            if (clienteId) {
                const cliente = clientes.find(c => c.id === clienteId);
                if (cliente) {
                    mostrarAlerta(`Cliente ${cliente.nome} selecionado`, 'success');
                }
            }
        }
        
        function selecionarFormaPagamento(forma) {
            document.getElementById('campoDinheiro').style.display = 'none';
            document.getElementById('campoCartao').style.display = 'none';
            
            if (forma === 'dinheiro') {
                document.getElementById('campoDinheiro').style.display = 'block';
                calcularTroco();
            } else if (forma === 'cartao_debito' || forma === 'cartao_credito') {
                document.getElementById('campoCartao').style.display = 'block';
            }
        }
        
        function calcularTroco() {
            const total = parseFloat(document.getElementById('carrinhoTotal').textContent.replace('R$ ', '').replace(',', '.'));
            const recebido = parseFloat(document.getElementById('valorRecebido').value) || 0;
            
            if (recebido >= total) {
                const troco = recebido - total;
                document.getElementById('valorTroco').value = troco.toFixed(2);
            } else {
                document.getElementById('valorTroco').value = '0.00';
            }
        }
        
        async function finalizarVenda() {
            if (carrinho.length === 0) {
                mostrarAlerta('Adicione produtos ao carrinho antes de finalizar a venda', 'error');
                return;
            }
            
            const total = parseFloat(document.getElementById('carrinhoTotal').textContent.replace('R$ ', '').replace(',', '.'));
            const clienteId = document.getElementById('clienteVenda').value;
            const formaPagamento = document.getElementById('formaPagamento').value;
            const desconto = parseFloat(document.getElementById('carrinhoDesconto').value) || 0;
            
            const cliente = clienteId ? clientes.find(c => c.id === clienteId) : null;
            
            // Confirmar venda
            if (confirm(`Confirmar venda no valor de R$ ${total.toFixed(2)}?`)) {
                try {
                    const db = window.firebaseDb;
                    const vendaId = 'VENDA-' + Date.now();
                    
                    // Criar objeto da venda
                    const venda = {
                        id: vendaId,
                        data: new Date().toISOString(),
                        clienteId: clienteId,
                        clienteNome: cliente?.nome || 'Cliente não identificado',
                        itens: carrinho.map(item => ({
                            produtoId: item.id,
                            codigo: item.codigo,
                            nome: item.nome,
                            quantidade: item.quantidade,
                            precoUnitario: item.preco,
                            subtotal: item.preco * item.quantidade
                        })),
                        subtotal: carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0),
                        desconto: desconto,
                        valorTotal: total,
                        formaPagamento: formaPagamento,
                        status: 'concluída',
                        vendedor: window.currentUser?.nome || 'Sistema',
                        dadosPagamento: {}
                    };
                    
                    // Adicionar dados específicos do pagamento
                    if (formaPagamento === 'dinheiro') {
                        venda.dadosPagamento = {
                            valorRecebido: parseFloat(document.getElementById('valorRecebido').value) || 0,
                            troco: parseFloat(document.getElementById('valorTroco').value) || 0
                        };
                    } else if (formaPagamento === 'cartao_debito' || formaPagamento === 'cartao_credito') {
                        venda.dadosPagamento = {
                            numeroCartao: document.getElementById('numeroCartao').value,
                            parcelas: parseInt(document.getElementById('parcelasCartao').value)
                        };
                    }
                    
                    // Salvar no Firebase
                    await window.firebaseAddDoc(window.firebaseCollection(db, "vendas"), venda);
                    
                    // Atualizar estoque dos produtos
                    for (const item of carrinho) {
                        const produtoRef = window.firebaseDoc(db, "produtos", item.id);
                        const produtoDoc = await window.firebaseGetDoc(produtoRef);
                        
                        if (produtoDoc.exists()) {
                            const produto = produtoDoc.data();
                            await window.firebaseUpdateDoc(produtoRef, {
                                estoque: produto.estoque - item.quantidade,
                                atualizadoEm: new Date().toISOString()
                            });
                            
                            // Atualizar localmente
                            const produtoLocal = produtos.find(p => p.id === item.id);
                            if (produtoLocal) {
                                produtoLocal.estoque -= item.quantidade;
                            }
                        }
                    }
                    
                    // Adicionar à lista local
                    vendas.push(venda);
                    
                    // Atualizar histórico do cliente se houver
                    if (clienteId) {
                        const clienteRef = window.firebaseDoc(db, "clientes", clienteId);
                        await window.firebaseUpdateDoc(clienteRef, {
                            totalCompras: (cliente?.totalCompras || 0) + total,
                            ultimaCompra: new Date().toISOString(),
                            quantidadeCompras: (cliente?.quantidadeCompras || 0) + 1
                        });
                    }
                    
                    mostrarAlerta('Venda realizada com sucesso!', 'success');
                    
                    // Gerar comprovante
                    gerarComprovanteVenda(venda);
                    
                    // Limpar carrinho
                    limparCarrinho();
                    
                    // Atualizar estatísticas
                    carregarEstatisticas();
                    carregarProdutosParaCaixa();
                    
                } catch (error) {
                    console.error('Erro ao finalizar venda:', error);
                    mostrarAlerta('Erro ao processar venda', 'error');
                }
            }
        }
        
        // ========== PRODUTOS ==========
        async function carregarProdutos() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "produtos"));
                
                produtos = [];
                querySnapshot.forEach((doc) => {
                    produtos.push({ id: doc.id, ...doc.data() });
                });
                
                // Se não houver produtos, criar alguns de exemplo
                if (produtos.length === 0) {
                    await criarProdutosExemplo();
                    await carregarProdutos(); // Recarregar
                    return;
                }
                
                atualizarTabelaProdutos();
                atualizarEstatisticasProdutos();
                
            } catch (error) {
                console.error("Erro ao carregar produtos:", error);
                mostrarAlerta("Erro ao carregar produtos", "error");
            }
        }
        
        async function criarProdutosExemplo() {
            try {
                const db = window.firebaseDb;
                const produtosExemplo = [
                    {
                        codigo: 'ARZ001',
                        nome: 'Arroz 5kg',
                        categoria: 'alimentos',
                        precoCusto: 18.50,
                        precoVenda: 24.90,
                        estoque: 50,
                        estoqueMinimo: 10,
                        fornecedor: 'Distribuidora Central',
                        descricao: 'Arroz branco tipo 1, pacote 5kg',
                        imagem: '',
                        criadoEm: new Date().toISOString(),
                        atualizadoEm: new Date().toISOString()
                    },
                    {
                        codigo: 'FEA001',
                        nome: 'Feijão 1kg',
                        categoria: 'alimentos',
                        precoCusto: 5.80,
                        precoVenda: 8.50,
                        estoque: 30,
                        estoqueMinimo: 10,
                        fornecedor: 'Distribuidora Central',
                        descricao: 'Feijão carioca, pacote 1kg',
                        imagem: '',
                        criadoEm: new Date().toISOString(),
                        atualizadoEm: new Date().toISOString()
                    }
                ];
                
                for (const produto of produtosExemplo) {
                    await window.firebaseAddDoc(window.firebaseCollection(db, "produtos"), produto);
                }
                
                mostrarAlerta("Produtos de exemplo criados com sucesso!", "success");
                
            } catch (error) {
                console.error("Erro ao criar produtos exemplo:", error);
                mostrarAlerta("Erro ao criar produtos exemplo", "error");
            }
        }
        
        function atualizarTabelaProdutos() {
            const tbody = document.getElementById('tabelaProdutos');
            tbody.innerHTML = '';
            
            if (produtos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 50px; color: var(--gray);">
                            <i class="fas fa-box-open" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Nenhum produto cadastrado</p>
                            <button class="btn btn-primary" onclick="abrirModalProduto()">
                                <i class="fas fa-plus"></i> Cadastrar Primeiro Produto
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            produtos.forEach(produto => {
                const status = produto.estoque > 0 ? 
                    `<span class="badge badge-success">Disponível</span>` :
                    `<span class="badge badge-danger">Sem Estoque</span>`;
                
                const margem = ((produto.precoVenda - produto.precoCusto) / produto.precoVenda * 100).toFixed(1);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${produto.codigo}</td>
                    <td>
                        <div><strong>${produto.nome}</strong></div>
                        ${produto.descricao ? `<small>${produto.descricao.substring(0, 50)}...</small>` : ''}
                    </td>
                    <td><span class="badge badge-primary">${produto.categoria}</span></td>
                    <td>R$ ${produto.precoCusto?.toFixed(2) || '0.00'}</td>
                    <td>R$ ${produto.precoVenda?.toFixed(2) || '0.00'}</td>
                    <td>${produto.estoque}</td>
                    <td>${status}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-xs" onclick="editarProduto('${produto.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-xs" onclick="excluirProduto('${produto.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function filtrarProdutosAdmin(termo) {
            const rows = document.querySelectorAll('#tabelaProdutos tr');
            const termoLower = termo.toLowerCase();
            
            rows.forEach(row => {
                if (row.cells.length > 1) {
                    const nome = row.cells[1].textContent.toLowerCase();
                    const codigo = row.cells[0].textContent.toLowerCase();
                    
                    if (nome.includes(termoLower) || codigo.includes(termoLower)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }
        
        async function salvarProduto(e) {
            e.preventDefault();
            
            try {
                const db = window.firebaseDb;
                const produtoId = document.getElementById('produtoId').value;
                
                const produtoData = {
                    codigo: document.getElementById('produtoCodigo').value,
                    nome: document.getElementById('produtoNome').value,
                    categoria: document.getElementById('produtoCategoria').value,
                    fornecedor: document.getElementById('produtoFornecedor').value,
                    precoCusto: parseFloat(document.getElementById('produtoPrecoCusto').value),
                    precoVenda: parseFloat(document.getElementById('produtoPrecoVenda').value),
                    estoque: parseInt(document.getElementById('produtoEstoque').value),
                    estoqueMinimo: parseInt(document.getElementById('produtoEstoqueMinimo').value),
                    descricao: document.getElementById('produtoDescricao').value,
                    imagem: document.getElementById('produtoImagem').value,
                    atualizadoEm: new Date().toISOString()
                };
                
                if (produtoId) {
                    // Atualizar produto existente
                    const produtoRef = window.firebaseDoc(db, "produtos", produtoId);
                    await window.firebaseUpdateDoc(produtoRef, produtoData);
                    
                    // Atualizar localmente
                    const index = produtos.findIndex(p => p.id === produtoId);
                    if (index !== -1) {
                        produtos[index] = { ...produtos[index], ...produtoData };
                    }
                    
                    mostrarAlerta("Produto atualizado com sucesso!", "success");
                } else {
                    // Criar novo produto
                    produtoData.criadoEm = new Date().toISOString();
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "produtos"), produtoData);
                    
                    // Adicionar localmente
                    produtos.push({ id: docRef.id, ...produtoData });
                    
                    mostrarAlerta("Produto cadastrado com sucesso!", "success");
                }
                
                fecharModal('modalProduto');
                atualizarTabelaProdutos();
                atualizarEstatisticasProdutos();
                await carregarProdutosParaCaixa();
                
            } catch (error) {
                console.error("Erro ao salvar produto:", error);
                mostrarAlerta("Erro ao salvar produto", "error");
            }
        }
        
        async function editarProduto(id) {
            try {
                const produto = produtos.find(p => p.id === id);
                if (!produto) return;
                
                document.getElementById('modalProdutoTitulo').textContent = 'Editar Produto';
                document.getElementById('produtoId').value = produto.id;
                document.getElementById('produtoCodigo').value = produto.codigo || '';
                document.getElementById('produtoNome').value = produto.nome || '';
                document.getElementById('produtoCategoria').value = produto.categoria || 'alimentos';
                document.getElementById('produtoFornecedor').value = produto.fornecedor || '';
                document.getElementById('produtoPrecoCusto').value = produto.precoCusto || '';
                document.getElementById('produtoPrecoVenda').value = produto.precoVenda || '';
                document.getElementById('produtoEstoque').value = produto.estoque || 0;
                document.getElementById('produtoEstoqueMinimo').value = produto.estoqueMinimo || 5;
                document.getElementById('produtoDescricao').value = produto.descricao || '';
                document.getElementById('produtoImagem').value = produto.imagem || '';
                
                abrirModal('modalProduto');
                
            } catch (error) {
                console.error("Erro ao carregar produto para edição:", error);
                mostrarAlerta("Erro ao carregar produto", "error");
            }
        }
        
        async function excluirProduto(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                try {
                    const db = window.firebaseDb;
                    await window.firebaseDeleteDoc(window.firebaseDoc(db, "produtos", id));
                    
                    // Remover localmente
                    const index = produtos.findIndex(p => p.id === id);
                    if (index !== -1) {
                        produtos.splice(index, 1);
                    }
                    
                    mostrarAlerta("Produto excluído com sucesso!", "success");
                    atualizarTabelaProdutos();
                    atualizarEstatisticasProdutos();
                    await carregarProdutosParaCaixa();
                    
                } catch (error) {
                    console.error("Erro ao excluir produto:", error);
                    mostrarAlerta("Erro ao excluir produto", "error");
                }
            }
        }
        
        function reporEstoque(id) {
            const quantidade = prompt('Quantidade a adicionar ao estoque:');
            if (quantidade && !isNaN(quantidade) && parseInt(quantidade) > 0) {
                // Em produção, atualizaria no Firebase
                const produto = produtos.find(p => p.id === id);
                if (produto) {
                    produto.estoque += parseInt(quantidade);
                    mostrarAlerta(`Estoque reposto em ${quantidade} unidades`, "success");
                    atualizarTabelaProdutos();
                    carregarProdutosEstoqueBaixo();
                }
            }
        }
        
        function atualizarEstatisticasProdutos() {
            const totalProdutos = produtos.length;
            const valorTotalEstoque = produtos.reduce((total, produto) => 
                total + (produto.precoCusto * produto.estoque), 0);
            const produtosSemEstoque = produtos.filter(p => p.estoque <= 0).length;
            
            // Encontrar categoria com mais produtos
            const categorias = {};
            produtos.forEach(p => {
                categorias[p.categoria] = (categorias[p.categoria] || 0) + 1;
            });
            const categoriaMaisProdutos = Object.keys(categorias).reduce((a, b) => 
                categorias[a] > categorias[b] ? a : b, 'Nenhuma');
            
            document.getElementById('totalProdutosCadastrados').textContent = totalProdutos;
            document.getElementById('valorTotalEstoque').textContent = `R$ ${valorTotalEstoque.toFixed(2)}`;
            document.getElementById('produtosSemEstoqueCount').textContent = produtosSemEstoque;
            document.getElementById('categoriaMaisProdutos').textContent = categoriaMaisProdutos;
            
            // Atualizar também na seção de configurações
            document.getElementById('totalProdutosConfig').textContent = totalProdutos;
            document.getElementById('valorEstoqueConfig').textContent = `R$ ${valorTotalEstoque.toFixed(2)}`;
        }
        
        function gerarRelatorioProdutos() {
            mostrarAlerta("Gerando relatório de produtos...", "info");
            // Em produção, geraria um relatório em PDF ou Excel
        }
        
        // ========== CLIENTES ==========
        async function carregarClientes() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "clientes"));
                
                clientes = [];
                querySnapshot.forEach((doc) => {
                    clientes.push({ id: doc.id, ...doc.data() });
                });
                
                // Se não houver clientes, criar alguns de exemplo
                if (clientes.length === 0) {
                    await criarClientesExemplo();
                    await carregarClientes(); // Recarregar
                    return;
                }
                
                atualizarTabelaClientes();
                criarGraficoClientes();
                
            } catch (error) {
                console.error("Erro ao carregar clientes:", error);
                mostrarAlerta("Erro ao carregar clientes", "error");
            }
        }
        
        async function criarClientesExemplo() {
            try {
                const db = window.firebaseDb;
                const clientesExemplo = [
                    {
                        nome: 'João da Silva',
                        cpf: '123.456.789-00',
                        telefone: '(75) 99999-9999',
                        email: 'joao@email.com',
                        endereco: 'Rua das Flores, 123',
                        tipo: 'normal',
                        dataCadastro: new Date().toISOString(),
                        totalCompras: 0,
                        quantidadeCompras: 0
                    },
                    {
                        nome: 'Maria Santos',
                        cpf: '987.654.321-00',
                        telefone: '(75) 98888-8888',
                        email: 'maria@email.com',
                        endereco: 'Av. Principal, 456',
                        tipo: 'vip',
                        dataCadastro: new Date().toISOString(),
                        totalCompras: 0,
                        quantidadeCompras: 0
                    }
                ];
                
                for (const cliente of clientesExemplo) {
                    await window.firebaseAddDoc(window.firebaseCollection(db, "clientes"), cliente);
                }
                
                mostrarAlerta("Clientes de exemplo criados com sucesso!", "success");
                
            } catch (error) {
                console.error("Erro ao criar clientes exemplo:", error);
                mostrarAlerta("Erro ao criar clientes exemplo", "error");
            }
        }
        
        function atualizarTabelaClientes() {
            const tbody = document.getElementById('tabelaClientes');
            tbody.innerHTML = '';
            
            if (clientes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 50px; color: var(--gray);">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Nenhum cliente cadastrado</p>
                            <button class="btn btn-primary" onclick="abrirModalCliente()">
                                <i class="fas fa-user-plus"></i> Cadastrar Primeiro Cliente
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            clientes.forEach(cliente => {
                const tipoCliente = cliente.tipo === 'vip' ? 
                    `<span class="badge badge-warning">VIP</span>` :
                    cliente.tipo === 'fidelizado' ?
                    `<span class="badge badge-success">FIDELIZADO</span>` :
                    `<span class="badge badge-primary">NORMAL</span>`;
                
                const ultimaCompra = cliente.ultimaCompra ? 
                    new Date(cliente.ultimaCompra).toLocaleDateString('pt-BR') : 
                    'Nenhuma compra';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div><strong>${cliente.nome}</strong></div>
                        ${cliente.email ? `<small>${cliente.email}</small>` : ''}
                    </td>
                    <td>${cliente.cpf || 'Não informado'}</td>
                    <td>${cliente.telefone}</td>
                    <td>${cliente.email || 'Não informado'}</td>
                    <td>${tipoCliente}</td>
                    <td>R$ ${(cliente.totalCompras || 0).toFixed(2)}</td>
                    <td>${ultimaCompra}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-xs" onclick="editarCliente('${cliente.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-info btn-xs" onclick="verHistoricoCliente('${cliente.id}')">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar estatísticas
            document.getElementById('totalClientesConfig').textContent = clientes.length;
        }
        
        function filtrarClientes(termo) {
            const rows = document.querySelectorAll('#tabelaClientes tr');
            const termoLower = termo.toLowerCase();
            
            rows.forEach(row => {
                if (row.cells.length > 1) {
                    const nome = row.cells[0].textContent.toLowerCase();
                    const cpf = row.cells[1].textContent.toLowerCase();
                    const telefone = row.cells[2].textContent.toLowerCase();
                    
                    if (nome.includes(termoLower) || cpf.includes(termoLower) || telefone.includes(termoLower)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }
        
        async function salvarCliente(e) {
            e.preventDefault();
            
            try {
                const db = window.firebaseDb;
                const clienteId = document.getElementById('clienteId').value;
                
                const clienteData = {
                    nome: document.getElementById('clienteNome').value,
                    cpf: document.getElementById('clienteCPF').value,
                    telefone: document.getElementById('clienteTelefone').value,
                    email: document.getElementById('clienteEmail').value,
                    endereco: document.getElementById('clienteEndereco').value,
                    nascimento: document.getElementById('clienteNascimento').value,
                    tipo: document.getElementById('clienteTipo').value,
                    atualizadoEm: new Date().toISOString()
                };
                
                if (clienteId) {
                    // Atualizar cliente existente
                    const clienteRef = window.firebaseDoc(db, "clientes", clienteId);
                    await window.firebaseUpdateDoc(clienteRef, clienteData);
                    
                    // Atualizar localmente
                    const index = clientes.findIndex(c => c.id === clienteId);
                    if (index !== -1) {
                        clientes[index] = { ...clientes[index], ...clienteData };
                    }
                    
                    mostrarAlerta("Cliente atualizado com sucesso!", "success");
                } else {
                    // Criar novo cliente
                    clienteData.dataCadastro = new Date().toISOString();
                    clienteData.totalCompras = 0;
                    clienteData.quantidadeCompras = 0;
                    
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "clientes"), clienteData);
                    
                    // Adicionar localmente
                    clientes.push({ id: docRef.id, ...clienteData });
                    
                    mostrarAlerta("Cliente cadastrado com sucesso!", "success");
                }
                
                fecharModal('modalCliente');
                atualizarTabelaClientes();
                carregarClientesParaVenda();
                
            } catch (error) {
                console.error("Erro ao salvar cliente:", error);
                mostrarAlerta("Erro ao salvar cliente", "error");
            }
        }
        
        async function editarCliente(id) {
            try {
                const cliente = clientes.find(c => c.id === id);
                if (!cliente) return;
                
                document.getElementById('modalClienteTitulo').textContent = 'Editar Cliente';
                document.getElementById('clienteId').value = cliente.id;
                document.getElementById('clienteNome').value = cliente.nome || '';
                document.getElementById('clienteCPF').value = cliente.cpf || '';
                document.getElementById('clienteTelefone').value = cliente.telefone || '';
                document.getElementById('clienteEmail').value = cliente.email || '';
                document.getElementById('clienteEndereco').value = cliente.endereco || '';
                document.getElementById('clienteNascimento').value = cliente.nascimento || '';
                document.getElementById('clienteTipo').value = cliente.tipo || 'normal';
                
                abrirModal('modalCliente');
                
            } catch (error) {
                console.error("Erro ao carregar cliente para edição:", error);
                mostrarAlerta("Erro ao carregar cliente", "error");
            }
        }
        
        function verHistoricoCliente(clienteId) {
            const cliente = clientes.find(c => c.id === clienteId);
            if (!cliente) return;
            
            // Em produção, carregaria o histórico do Firebase
            mostrarAlerta(`Histórico do cliente ${cliente.nome} carregado`, "info");
        }
        
        function criarGraficoClientes() {
            const ctx = document.getElementById('graficoClientes').getContext('2d');
            
            if (graficoClientes) {
                graficoClientes.destroy();
            }
            
            // Dados de exemplo
            const labels = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const data = [15, 22, 18, 25, 30, 28];
            
            graficoClientes = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Novos Clientes',
                        data: data,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: '#3498db',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoClientes(periodo) {
            // Em produção, atualizaria o gráfico com dados reais
            mostrarAlerta(`Gráfico atualizado para período ${periodo}`, "info");
        }
        
        // ========== FUNCIONÁRIOS ==========
        async function carregarFuncionarios() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "funcionarios"));
                
                funcionarios = [];
                querySnapshot.forEach((doc) => {
                    funcionarios.push({ id: doc.id, ...doc.data() });
                });
                
                // Se não houver funcionários, criar alguns de exemplo
                if (funcionarios.length === 0) {
                    await criarFuncionariosExemplo();
                    await carregarFuncionarios(); // Recarregar
                    return;
                }
                
                atualizarTabelaFuncionarios();
                
            } catch (error) {
                console.error("Erro ao carregar funcionários:", error);
                mostrarAlerta("Erro ao carregar funcionários", "error");
            }
        }
        
        async function criarFuncionariosExemplo() {
            try {
                const db = window.firebaseDb;
                const funcionariosExemplo = [
                    {
                        nome: 'Carlos Oliveira',
                        cpf: '111.222.333-44',
                        cargo: 'caixa',
                        telefone: '(75) 97777-7777',
                        email: 'carlos@email.com',
                        salario: 1800.00,
                        endereco: 'Rua Comercial, 789',
                        admissao: '2023-01-15',
                        status: 'ativo',
                        dataCadastro: new Date().toISOString()
                    },
                    {
                        nome: 'Ana Paula',
                        cpf: '555.666.777-88',
                        cargo: 'gerente',
                        telefone: '(75) 96666-6666',
                        email: 'ana@email.com',
                        salario: 3500.00,
                        endereco: 'Av. Central, 321',
                        admissao: '2022-03-10',
                        status: 'ativo',
                        dataCadastro: new Date().toISOString()
                    }
                ];
                
                for (const funcionario of funcionariosExemplo) {
                    await window.firebaseAddDoc(window.firebaseCollection(db, "funcionarios"), funcionario);
                }
                
                mostrarAlerta("Funcionários de exemplo criados com sucesso!", "success");
                
            } catch (error) {
                console.error("Erro ao criar funcionários exemplo:", error);
                mostrarAlerta("Erro ao criar funcionários exemplo", "error");
            }
        }
        
        function atualizarTabelaFuncionarios() {
            const tbody = document.getElementById('tabelaFuncionarios');
            tbody.innerHTML = '';
            
            if (funcionarios.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 50px; color: var(--gray);">
                            <i class="fas fa-user-tie" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Nenhum funcionário cadastrado</p>
                            <button class="btn btn-primary" onclick="abrirModalFuncionario()">
                                <i class="fas fa-user-plus"></i> Cadastrar Primeiro Funcionário
                            </td>
                        </tr>
                `;
                return;
            }
            
            funcionarios.forEach(funcionario => {
                const status = funcionario.status === 'ativo' ? 
                    `<span class="badge badge-success">ATIVO</span>` :
                    `<span class="badge badge-danger">INATIVO</span>`;
                
                const cargo = funcionario.cargo === 'gerente' ? 
                    `<span class="badge badge-warning">GERENTE</span>` :
                    funcionario.cargo === 'caixa' ?
                    `<span class="badge badge-primary">CAIXA</span>` :
                    `<span class="badge badge-info">${funcionario.cargo.toUpperCase()}</span>`;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div><strong>${funcionario.nome}</strong></div>
                        ${funcionario.email ? `<small>${funcionario.email}</small>` : ''}
                    </td>
                    <td>${cargo}</td>
                    <td>${funcionario.cpf}</td>
                    <td>${funcionario.telefone}</td>
                    <td>R$ ${(funcionario.salario || 0).toFixed(2)}</td>
                    <td>${status}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-xs" onclick="editarFuncionario('${funcionario.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-xs" onclick="excluirFuncionario('${funcionario.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function filtrarFuncionarios(termo) {
            const rows = document.querySelectorAll('#tabelaFuncionarios tr');
            const termoLower = termo.toLowerCase();
            
            rows.forEach(row => {
                if (row.cells.length > 1) {
                    const nome = row.cells[0].textContent.toLowerCase();
                    const cargo = row.cells[1].textContent.toLowerCase();
                    
                    if (nome.includes(termoLower) || cargo.includes(termoLower)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }
        
        async function salvarFuncionario(e) {
            e.preventDefault();
            
            try {
                const db = window.firebaseDb;
                const funcionarioId = document.getElementById('funcionarioId').value;
                
                const funcionarioData = {
                    nome: document.getElementById('funcionarioNome').value,
                    cpf: document.getElementById('funcionarioCPF').value,
                    cargo: document.getElementById('funcionarioCargo').value,
                    salario: parseFloat(document.getElementById('funcionarioSalario').value) || 0,
                    telefone: document.getElementById('funcionarioTelefone').value,
                    email: document.getElementById('funcionarioEmail').value,
                    endereco: document.getElementById('funcionarioEndereco').value,
                    admissao: document.getElementById('funcionarioAdmissao').value,
                    status: document.getElementById('funcionarioStatus').value,
                    atualizadoEm: new Date().toISOString()
                };
                
                if (funcionarioId) {
                    // Atualizar funcionário existente
                    const funcionarioRef = window.firebaseDoc(db, "funcionarios", funcionarioId);
                    await window.firebaseUpdateDoc(funcionarioRef, funcionarioData);
                    
                    // Atualizar localmente
                    const index = funcionarios.findIndex(f => f.id === funcionarioId);
                    if (index !== -1) {
                        funcionarios[index] = { ...funcionarios[index], ...funcionarioData };
                    }
                    
                    mostrarAlerta("Funcionário atualizado com sucesso!", "success");
                } else {
                    // Criar novo funcionário
                    funcionarioData.dataCadastro = new Date().toISOString();
                    
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "funcionarios"), funcionarioData);
                    
                    // Adicionar localmente
                    funcionarios.push({ id: docRef.id, ...funcionarioData });
                    
                    mostrarAlerta("Funcionário cadastrado com sucesso!", "success");
                }
                
                fecharModal('modalFuncionario');
                atualizarTabelaFuncionarios();
                
            } catch (error) {
                console.error("Erro ao salvar funcionário:", error);
                mostrarAlerta("Erro ao salvar funcionário", "error");
            }
        }
        
        async function editarFuncionario(id) {
            try {
                const funcionario = funcionarios.find(f => f.id === id);
                if (!funcionario) return;
                
                document.getElementById('modalFuncionarioTitulo').textContent = 'Editar Funcionário';
                document.getElementById('funcionarioId').value = funcionario.id;
                document.getElementById('funcionarioNome').value = funcionario.nome || '';
                document.getElementById('funcionarioCPF').value = funcionario.cpf || '';
                document.getElementById('funcionarioCargo').value = funcionario.cargo || '';
                document.getElementById('funcionarioSalario').value = funcionario.salario || '';
                document.getElementById('funcionarioTelefone').value = funcionario.telefone || '';
                document.getElementById('funcionarioEmail').value = funcionario.email || '';
                document.getElementById('funcionarioEndereco').value = funcionario.endereco || '';
                document.getElementById('funcionarioAdmissao').value = funcionario.admissao || '';
                document.getElementById('funcionarioStatus').value = funcionario.status || 'ativo';
                
                abrirModal('modalFuncionario');
                
            } catch (error) {
                console.error("Erro ao carregar funcionário para edição:", error);
                mostrarAlerta("Erro ao carregar funcionário", "error");
            }
        }
        
        async function excluirFuncionario(id) {
            if (confirm('Tem certeza que deseja excluir este funcionário?')) {
                try {
                    const db = window.firebaseDb;
                    await window.firebaseDeleteDoc(window.firebaseDoc(db, "funcionarios", id));
                    
                    // Remover localmente
                    const index = funcionarios.findIndex(f => f.id === id);
                    if (index !== -1) {
                        funcionarios.splice(index, 1);
                    }
                    
                    mostrarAlerta("Funcionário excluído com sucesso!", "success");
                    atualizarTabelaFuncionarios();
                    
                } catch (error) {
                    console.error("Erro ao excluir funcionário:", error);
                    mostrarAlerta("Erro ao excluir funcionário", "error");
                }
            }
        }
        
        // ========== VENDAS ==========
        async function carregarVendas() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(
                    window.firebaseQuery(
                        window.firebaseCollection(db, "vendas"),
                        window.firebaseOrderBy("data", "desc")
                    )
                );
                
                vendas = [];
                querySnapshot.forEach((doc) => {
                    vendas.push({ id: doc.id, ...doc.data() });
                });
                
                atualizarTabelaVendas();
                document.getElementById('totalVendasConfig').textContent = vendas.length;
                
            } catch (error) {
                console.error("Erro ao carregar vendas:", error);
                mostrarAlerta("Erro ao carregar vendas", "error");
            }
        }
        
        function atualizarTabelaVendas() {
            const tbody = document.getElementById('tabelaVendas');
            tbody.innerHTML = '';
            
            if (vendas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 50px; color: var(--gray);">
                            <i class="fas fa-receipt" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Nenhuma venda registrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            vendas.forEach(venda => {
                const produtosLista = venda.itens.slice(0, 2).map(item => 
                    `${item.quantidade}x ${item.nome}`
                ).join(', ');
                
                const maisItens = venda.itens.length > 2 ? ` e +${venda.itens.length - 2}` : '';
                
                const status = venda.status === 'concluída' ? 
                    `<span class="badge badge-success">CONCLUÍDA</span>` :
                    venda.status === 'cancelada' ?
                    `<span class="badge badge-danger">CANCELADA</span>` :
                    `<span class="badge badge-warning">${venda.status.toUpperCase()}</span>`;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${venda.id.substring(0, 8)}</td>
                    <td>${new Date(venda.data).toLocaleString('pt-BR')}</td>
                    <td>${venda.clienteNome}</td>
                    <td>${produtosLista}${maisItens}</td>
                    <td>R$ ${venda.valorTotal.toFixed(2)}</td>
                    <td>${venda.formaPagamento}</td>
                    <td>${status}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-info btn-xs" onclick="verDetalhesVenda('${venda.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-warning btn-xs" onclick="solicitarCancelamentoVenda('${venda.id}')" ${venda.status === 'concluída' ? '' : 'disabled'}>
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function filtrarVendasPorData() {
            const dataInicio = document.getElementById('dataInicioVendas').value;
            const dataFim = document.getElementById('dataFimVendas').value;
            
            if (!dataInicio && !dataFim) {
                atualizarTabelaVendas();
                return;
            }
            
            // Em produção, filtraria do Firebase
            mostrarAlerta("Filtro aplicado (funcionalidade completa em desenvolvimento)", "info");
        }
        
        async function verDetalhesVenda(vendaId) {
            try {
                const venda = vendas.find(v => v.id === vendaId);
                if (!venda) return;
                
                let detalhesHTML = `
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Informações da Venda</h4>
                        <p><strong>ID:</strong> ${venda.id}</p>
                        <p><strong>Data/Hora:</strong> ${new Date(venda.data).toLocaleString('pt-BR')}</p>
                        <p><strong>Cliente:</strong> ${venda.clienteNome}</p>
                        <p><strong>Vendedor:</strong> ${venda.vendedor}</p>
                        <p><strong>Forma de Pagamento:</strong> ${venda.formaPagamento}</p>
                        <p><strong>Status:</strong> ${venda.status}</p>
                    </div>
                    
                    <h4 style="color: var(--primary); margin-bottom: 15px;">Produtos</h4>
                    <div class="table-container" style="margin-bottom: 25px;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Quantidade</th>
                                    <th>Preço Unitário</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                venda.itens.forEach(item => {
                    detalhesHTML += `
                        <tr>
                            <td>${item.nome}</td>
                            <td>${item.quantidade}</td>
                            <td>R$ ${item.precoUnitario.toFixed(2)}</td>
                            <td>R$ ${item.subtotal.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                detalhesHTML += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Subtotal:</span>
                            <span>R$ ${venda.subtotal.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Desconto:</span>
                            <span>R$ ${venda.desconto.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem; border-top: 2px solid #e0e6ed; padding-top: 10px;">
                            <span>TOTAL:</span>
                            <span>R$ ${venda.valorTotal.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('vendaDetalhes').innerHTML = detalhesHTML;
                abrirModal('modalVenda');
                
            } catch (error) {
                console.error("Erro ao carregar detalhes da venda:", error);
                mostrarAlerta("Erro ao carregar detalhes da venda", "error");
            }
        }
        
        function solicitarCancelamentoVenda(vendaId) {
            const motivo = prompt('Motivo do cancelamento:');
            if (!motivo) return;
            
            // Em produção, criaria uma solicitação de cancelamento
            mostrarAlerta('Solicitação de cancelamento enviada para aprovação', 'warning');
        }
        
        async function carregarCancelamentos() {
            // Em produção, carregaria do Firebase
            const tbody = document.getElementById('tabelaCancelamentos');
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--success);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        Nenhuma solicitação de cancelamento pendente
                    </td>
                </tr>
            `;
        }
        
        function exportarVendas() {
            mostrarAlerta("Exportando vendas...", "info");
            // Em produção, geraria um arquivo Excel
        }
        
        // ========== COMPROVANTE ==========
        function gerarComprovanteVenda(venda) {
            // Atualizar informações da loja no comprovante
            document.getElementById('comprovanteNomeLoja').textContent = 
                configuracoes.nomeLoja || 'SUPERMERCADO PRO';
            document.getElementById('comprovanteEndereco').textContent = 
                configuracoes.endereco || 'Endereço não configurado';
            document.getElementById('comprovanteTelefone').textContent = 
                configuracoes.telefone || 'Telefone não configurado';
            document.getElementById('comprovanteCNPJ').textContent = 
                `CNPJ: ${configuracoes.cnpj || 'Não informado'}`;
            document.getElementById('comprovanteData').textContent = 
                `Data: ${new Date(venda.data).toLocaleString('pt-BR')}`;
            document.getElementById('comprovanteVenda').textContent = 
                `Venda: ${venda.id.substring(0, 8)}`;
            
            // Adicionar itens
            const itemsContainer = document.getElementById('comprovanteItems');
            itemsContainer.innerHTML = '';
            
            venda.itens.forEach(item => {
                const div = document.createElement('div');
                div.className = 'comprovante-item';
                div.innerHTML = `
                    <div>
                        <div>${item.nome}</div>
                        <small>${item.quantidade} x R$ ${item.precoUnitario.toFixed(2)}</small>
                    </div>
                    <div>R$ ${item.subtotal.toFixed(2)}</div>
                `;
                itemsContainer.appendChild(div);
            });
            
            // Atualizar total
            document.getElementById('comprovanteTotal').textContent = 
                `R$ ${venda.valorTotal.toFixed(2)}`;
            
            // Mostrar modal
            abrirModal('modalComprovante');
        }
        
        function imprimirComprovante() {
            const comprovante = document.getElementById('comprovantePreview');
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Comprovante de Venda</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .comprovante-preview { max-width: 400px; margin: 0 auto; }
                            .comprovante-header { text-align: center; margin-bottom: 20px; }
                            .comprovante-title { font-size: 1.5rem; font-weight: bold; }
                            .comprovante-item { display: flex; justify-content: space-between; margin-bottom: 8px; }
                            .comprovante-total { display: flex; justify-content: space-between; font-weight: bold; margin-top: 20px; padding-top: 10px; border-top: 2px dashed #000; }
                            @media print {
                                body { margin: 0; }
                                button { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        ${comprovante.innerHTML}
                    </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        async function salvarComprovante() {
            try {
                const comprovante = document.getElementById('comprovantePreview');
                
                // Usar html2canvas para capturar como imagem
                const canvas = await html2canvas(comprovante);
                
                // Converter para PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190;
                const pageHeight = pdf.internal.pageSize.height;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 10;
                
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`comprovante-${Date.now()}.pdf`);
                mostrarAlerta('Comprovante salvo como PDF!', 'success');
                
            } catch (error) {
                console.error('Erro ao salvar comprovante:', error);
                mostrarAlerta('Erro ao salvar comprovante', 'error');
            }
        }
        
        // ========== RELATÓRIOS ==========
        function gerarRelatorioTipo(tipo) {
            mostrarAlerta(`Gerando relatório de ${tipo}...`, "info");
            // Em produção, geraria um relatório em PDF ou Excel
        }
        
        function gerarRelatorioCompleto() {
            mostrarAlerta("Gerando relatório completo em PDF...", "info");
            // Em produção, geraria um PDF completo
        }
        
        function exportarDados(tipo) {
            mostrarAlerta(`Exportando dados de ${tipo}...`, "info");
            // Em produção, geraria um arquivo Excel
        }
        
        function exportarTodosDados() {
            mostrarAlerta("Exportando todos os dados...", "info");
            // Em produção, geraria um arquivo Excel completo
        }
        
        // ========== BACKUP E SEGURANÇA ==========
        function criarBackup() {
            if (confirm('Deseja criar um backup do sistema?')) {
                mostrarAlerta("Criando backup do sistema...", "info");
                // Em produção, faria backup no Firebase
            }
        }
        
        function alterarSenha() {
            const novaSenha = prompt('Digite a nova senha:');
            if (novaSenha && novaSenha.length >= 6) {
                mostrarAlerta("Senha alterada com sucesso!", "success");
            }
        }
        
        function gerarLogs() {
            mostrarAlerta("Gerando logs do sistema...", "info");
        }
        
        function restaurarBackup() {
            if (confirm('Deseja restaurar o último backup?')) {
                mostrarAlerta("Restaurando backup...", "info");
            }
        }
        
        function limparDados() {
            if (confirm('ATENÇÃO: Esta ação irá limpar todos os dados do sistema. Tem certeza?')) {
                if (confirm('CONFIRMAÇÃO FINAL: Esta ação é irreversível. Tem certeza absoluta?')) {
                    mostrarAlerta("Limpando dados do sistema...", "warning");
                }
            }
        }
        
        // ========== CARREGAMENTO INICIAL ==========
        async function carregarDadosIniciais() {
            try {
                await Promise.all([
                    carregarProdutos(),
                    carregarClientes(),
                    carregarFuncionarios(),
                    carregarVendas()
                ]);
                
                mostrarAlerta("Sistema carregado com sucesso!", "success");
                
            } catch (error) {
                console.error("Erro ao carregar dados iniciais:", error);
                mostrarAlerta("Erro ao carregar dados do sistema", "error");
            }
        }
        
        // Expor funções para uso global
        window.mostrarSecao = mostrarSecao;
        window.abrirModal = abrirModal;
        window.fecharModal = fecharModal;
        window.adminLogout = adminLogout;
        window.imprimirComprovante = imprimirComprovante;
        window.salvarComprovante = salvarComprovante;
        window.limparCarrinho = limparCarrinho;
        window.abrirModalProduto = abrirModalProduto;
        window.abrirModalCliente = abrirModalCliente;
        window.abrirModalFuncionario = abrirModalFuncionario;
        
        // Inicializar sistema quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            if (window.currentUser) {
                initSistema();
            }
        });
    </script>
</body>
</html>